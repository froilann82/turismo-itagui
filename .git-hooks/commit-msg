#!/bin/sh
#
# Commit message hook - Validación Conventional Commits
# Formatos válidos: feat(scope): descripción | fix: descripción | docs: descripción | chore: descripción

commit_message=$(cat "$1")

# Ignorar commits de merge
if echo "$commit_message" | grep -qE "^Merge (branch|remote)"; then
    exit 0
fi

# Extraer primera línea
commit_subject=$(echo "$commit_message" | head -n1)

# Validar formato: (feat|fix|docs|chore)(scope opcional): descripción
if ! echo "$commit_subject" | grep -qE "^(feat|fix|docs|chore)(\(.+\))?: .{1,50}"; then
    echo ""
    echo "ERROR: Mensaje de commit inválido"
    echo "Actual: '$commit_subject'"
    echo ""
    echo "Formato esperado:"
    echo "  feat: nueva funcionalidad"
    echo "  feat(scope): nueva funcionalidad con scope"
    echo "  fix: corrección de bug"
    echo "  docs: cambios en documentación"
    echo "  chore: tareas de mantenimiento"
    echo ""
    echo "Ejemplos válidos:"
    echo "  feat: agregar mapa interactivo"
    echo "  feat(mapa): agregar filtros"
    echo "  fix: corregir error en favoritos"
    echo "  docs: actualizar README"
    echo "  chore: actualizar dependencias"
    echo ""
    exit 1
fi

exit 0

